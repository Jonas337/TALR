type: x-detection-rule
id: x-detection-rule--1c58eee4-8b30-4a25-92e1-6aee1f916416
created: '2018-12-03T23:30:44.742Z'
modified: '2018-12-03T23:30:44.742Z'
title: Malware Shellcode in Verclsid Target Process
status: experimental
description: Detects a process access to verclsid.exe that injects shellcode from
  a Microsoft Office application / VBA macro
references:
- https://twitter.com/JohnLaTwC/status/837743453039534080
author: John Lambert (tech), Florian Roth (rule)
date: 2017/03/04
logsource:
  product: windows
  description: 'Use the following config to generate the necessary Event ID 10 Process
    Access events: <ProcessAccess onmatch="include"><CallTrace condition="contains">VBE7.DLL</CallTrace></ProcessAccess><ProcessAccess
    onmatch="exclude"><CallTrace condition="excludes">UNKNOWN</CallTrace></ProcessAccess>'
  service: sysmon
detection:
  combination1:
    CallTrace: '*|UNKNOWN(*VBE7.DLL*'
  combination2:
    CallTrace: '*|UNKNOWN*'
    SourceImage: '*\Microsoft Office\*'
  condition: selection and 1 of combination*
  selection:
    EventID: 10
    GrantedAccess: '0x1FFFFF'
    TargetImage: '*\verclsid.exe'
falsepositives:
- unknown
level: high
source: sigma
